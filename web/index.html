<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>
        Websocket test
    </title>
</head>
<body>
    <h1>
        Hello games
    </h1>
    <button class="js-game-button">Join game</button>
    <pre class="event-log"></pre>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        function getRandomIntInclusive( min, max ) {
            min = Math.ceil( min );
            max = Math.floor( max );

            return Math.floor( Math.random() * ( max - min + 1 ) ) + min;
        }

        let socket;

        (function(){
            socket = io();
            const moves = [
                'rock',
                'paper',
                'scissors',
            ];

            let move = false;

            socket.on( 'send-move', () => {
                move = moves[ getRandomIntInclusive( 0, 2 ) ];
                socket.emit( 'move', move );
            } );

            socket.on( 'game-ended', ( gameData ) => {
                console.log( gameData.result, move );

                setButtonText( `${ gameData.result }! - Press to join` );
            } );

            const setButtonText = function setButtonText( text ) {
                document.querySelector( '.js-game-button' ).innerText = text;
            }

            const joinGame = function joinGame() {
                socket.emit( 'join-game', {
                    type: 'RockPaperScissors',
                    opponent: 'random',
                } );

                setButtonText( 'Waiting for opponent' );
            };

            document.querySelector( '.js-game-button' ).addEventListener( 'click', joinGame );
        })();
    </script>
